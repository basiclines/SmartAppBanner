(function(){var http=function(config){var req=new XMLHttpRequest;var method=config.data?"POST":"GET";req.open(method,config.url,true);req.setRequestHeader("User-Agent","XMLHTTP/1.0");if(config.data){req.setRequestHeader("Content-type","application/x-www-form-urlencoded")}req.onreadystatechange=function(){if(req.readyState!=4)return;if(req.status!=200&&req.status!=304){if(typeof config.error!="function"){console.log(req.status+": "+req.response)}else{config.error(req.status,req.response)}return}config.success(req.response)};if(req.readyState==4)return;req.send(config.data)};var loadJSONP=function(){var unique=0;return function(url,callback,context){var name="_jsonp_"+unique++;if(url.match(/\?/))url+="&callback="+name;else url+="?callback="+name;var script=document.createElement("script");script.type="text/javascript";script.src=url;window[name]=function(data){callback.call(context||window,data);document.getElementsByTagName("head")[0].removeChild(script);script=null;delete window[name]};document.getElementsByTagName("head")[0].appendChild(script)}}();var system=function(){var obj={ios:false,android:false,mobile:false};var iOS=navigator.userAgent.search("Mobile")!=-1&&navigator.userAgent.search("iPhone OS")!=-1;var Android=navigator.userAgent.search("Mobile")!=-1&&navigator.userAgent.search("Android")!=-1;var isMobile=Android||iOS||window.innerWidth<480;if(iOS){obj.ios=true}if(Android){obj.android=true}if(isMobile){obj.mobile=true}return obj}();SmartAppBanner=function(){var localConfig={locale:navigator.language.split("-")[1].toUpperCase(),tplSelector:"[data-template=smartapp-banner]",tplDir:"/static/modules/smartapp-banner/",isAnimated:true,showPrice:true,viewURL:false,strings:{appStoreClaim:"On the App Store",viewButton:"view",openButton:"open"},strings_ES:{appStoreClaim:"En la App Store",viewButton:"ver",openButton:"abrir"}};if(typeof SmartAppBannerConfig=="object"){for(var i in SmartAppBannerConfig){localConfig[i]=SmartAppBannerConfig[i]}}localConfig.api="http://itunes.apple.com/lookup?country="+localConfig.locale+"&id=";if(localConfig.locale=="ES"){localConfig.strings=localConfig.strings_ES}return{getConfig:function(){var metatag=document.querySelector("meta[name=apple-itunes-app]");if(metatag){var content=metatag.getAttribute("content").split(",");for(var i in content){if(content[i].search("app-id=")!=-1){var appID=content[i].replace("app-id=","")}else if(content[i].search("app-argument=")!=-1){var appArgs=content[i].replace("app-argument=","")}}return{appID:appID,appArgs:appArgs}}},getData:function(appID,callback){loadJSONP(localConfig.api+appID,function(data){if(typeof callback=="function"){callback(data)}})},parseData:function(metadata,template){var info={icon:metadata.artworkUrl100,name:metadata.trackName,price:metadata.formattedPrice,averageUserRating:parseInt(metadata.averageUserRating),userRatingCount:metadata.userRatingCount,viewUrl:!localConfig.viewURL?metadata.trackViewUrl:localConfig.viewURL,openUrl:metadata.openUrl,viewNodeIsHidden:metadata.viewNodeIsHidden?"hidden":"",openNodeIsHidden:metadata.openNodeIsHidden?"hidden":"",ratingNodeIsHidden:metadata.ratingNodeIsHidden?"hidden":"",viewString:metadata.viewString,openString:metadata.openString,appStoreString:metadata.appStoreString};for(var i in info){var key=i;var value=typeof info[i]=="undefined"?"":info[i];var template=template.replace(new RegExp("{_"+key+"_}","g"),value)}return template},hide:function(isAnimated){var banner=document.body.querySelector(localConfig.tplSelector);if(isAnimated){document.body.classList.remove("sab-active");banner.setAttribute("hidden","")}else{document.body.classList.remove("sab-active");banner.style.transition="none";banner.style.webkitTransition="none";banner.setAttribute("hidden","")}},show:function(isAnimated){var banner=document.body.querySelector(localConfig.tplSelector);if(isAnimated){var delay=setTimeout(function(){document.body.classList.add("sab-active");banner.removeAttribute("hidden")},70)}else{document.body.classList.add("sab-active");banner.removeAttribute("hidden")}},bindEvents:function(){var context=this;var banner=document.body.querySelector(localConfig.tplSelector);var closeButton=banner.querySelector("[data-trigger=close]");closeButton.addEventListener("click",function(e){context.hide(localConfig.isAnimated);e.preventDefault()})},init:function(options){var config=this.getConfig();var context=this;this.getData(config.appID,function(response){var info=response.results[0];info.openUrl=config.appArgs;info.appID=config.appID;info.appStoreString=localConfig.strings.appStoreClaim;info.viewString=localConfig.showPrice?info.formattedPrice:localConfig.strings.viewButton;info.openString=localConfig.strings.openButton;if(typeof info.openUrl=="undefined"){info.openNodeIsHidden=true}else{info.viewNodeIsHidden=true}if(typeof info.averageUserRating=="undefined"){info.ratingNodeIsHidden=true}http({url:localConfig.tplDir+"template.html",success:function(tpl){var banner=context.parseData(info,tpl);document.body.insertAdjacentHTML("afterbegin",banner);context.bindEvents();context.show(localConfig.isAnimated)}})})}}}();if(system.ios){SmartAppBanner.init()}})();